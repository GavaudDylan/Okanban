# JOUR 3 - API - REST & CRUD (partie 1)

## Menu du jour

```
=== Matin COURS ===

- Correction
  - Modèles Sequelize (Cards & Tags)
  - Associations
  - Scripts (`createTables.js` && `seedTables.js`)

- API REST
  - Conventions REST (verbes et chemins)
    - Documentation d'API
  - Clients HTTP
    - Insomnia
  - Architecture
    - Mise en place du serveur Express (en ESM)
    - Spécifications : /lists
    - Première route : GET /lists

- Gitflow 
  - mettre à jour son master

=== Aprem ATELIER ===

- API REST
  - GET /lists
  - GET /lists/:id
  - POST /lists
  - PATCH /lists/:id
  - DELETE /lists
```

## Préférence VSCode 

- Pour les ouvrir : `CTRL + SHIFT + P`

- Taper `"Open User Settings (JSON)"`

- Ajouter : `"javascript.preferences.importModuleSpecifierEnding": "js",` pour avoir les imports automatisés avec l'extension `.js` 

## ESM

L'extension `.js` est obligatoire pour les imports des modules locaux (modules créés manuellement). 

3 types de modules : 
- les modules tiers (NPM)
- les modules core (Node)
- les modules locaux (export)

## Sequelize synchronization des modèles

On peut, sans passer par des scripts SQL, créer nos TABLES dans notre BDD en utilisant nos modèles Sequelize et l'API de Sequelize : 

- `sequelize.drop()` : supprimer toutes les tables
- `sequelize.sync()` : créer toutes les tables / synchroniser
- `Model.drop()` : supprimer une table
- `Model.sync()` : créer/synchroniser UNE table

Mon conseil : **au TP, faite en SQL, pour montrer vos compétences SQL !**

Eventuellement les deux, garder simplement l'équivalent SQL sous le coude si on vous demande ! 

Avantage : 
- on ne sort pas le nez de JS
- on ne définie les modèles 2 fois !


## API 

API = une interface entre un client HTTP (ex: `fetch` en JS) et notre BDD (ex : Sequelize->okanban)

- On va créer cette interface, ie : on va créer une liste de routes HTTP qui permettent de communiquer avec la BDD, indirectement et de manière sécurisé.
  - outils : Express, Sequelize, (PAS EJS -> pas de vues, on renvoie du JSON)
  - conventions... `REST`

## `API REST`

- REpresentational State Transfer
- style d'architecture communes pour les API
- un ensemble de règles sur :
  - comment bien nommer les URL
  - comment bien choisir le verbe HTTP
  - comment bien choisir les headers
  - comment bien choisir les status code

Exemple d'API qui respecte bien les conventions REST : 
- `Spotify`


### Verbes

Indique l'intention

- `GET` : obtenir des ressources
- `POST` : créer une ressource
- `PATCH` : modifier une ressource
- `PUT` : remplacer (entièrement) une ressource
- `DELETE` : supprimer une ressource

### URL

Indique la ressource visée :

- `/resources/:id/subresource`

Ex : 
- `/GET /artists/:id/albums` : récupérer les albums d'un article
- `DELETE /playlists/:id/tracks` + `BODY { tracks }` : supprimer des tracks dans une playlist
- `GET /audiobooks/:id/chapters` : récupére les chapitres d'un certain audiobook



### Status Code

- `200` : Ok
- `201` : Created

- `300` : Redirect

- `400` : Bad Request (par exemple, le body fourni n'est pas bon !)
- `401` : Unauthorized (on n'est pas authentifié)
- `403` : Forbidden (on est authentifié mais on a pas les droits)
- `404` : Not Found (la resource demandé n'existe pas)

- `500` : Erreur serveur (ex: la BDD de Spotify est eteinte)


Routes à créer : 
- `GET /lists` : récupérer toutes les listes
- `GET /lists/id` : récupérer une liste
- `POST /lists` : créer une liste
- `PATCH /lists/:id` : modifier une liste
- `DELETE /lists/:id` : supprimer une liste
- `GET /lists/:id/cards` : récupérer les cartes de la liste n°X


Dès demain : 
- `GET /cards` : récupérer toutes les cartes
- `GET /cards/id` : récupérer une carte
- `POST /cards` : créer une carte
- `PATCH /cards/:id` : modifier une carte
- `DELETE /cards/:id` : supprimer une carte

- `GET /tags` : récupérer toutes les labels
- `GET /tags/id` : récupérer une label
- `POST /tags` : créer une label
- `PUT /tags/:id` : modifier une label
- `DELETE /tags/:id` : supprimer une label
- `PUT /cards/:cardId/labels/:labels` : ajouter un label sur une carte
- `DELETE /cards/:cardId/labels/:labels` : supprimer un label d'une carte


"Route CRUD" = Routes CREATE/UPDATE/DELETE/READ


- Question : "pour supprimer par exemple, pourquoi ne pas faire une route `GET /delete/list/:listId`
  - Réponse : on pourrait, ça marcherait très bien
    - MAIS on ne respecte pas les conventions `REST` 


## Gitflow

- Ouvrir votre dépôt personnel dans VSCode
- Ouvrir un terminal VSCode, fermer les autres onglet
- Sauvegarder vos fichiers, commit, push si necessaire
- (SI NON FAIT HIER) Ajouter le remote prof au dépôt local : `git remote add prof git@github.com:O-clock-Pavlova/S12-okanban-API-enzoclock.git`
- Retourner sur master : `git checkout master`
- Fetch les changements du prof : `git fetch prof`
- Intégrer les changements du prof dans mon master : `git reset --hard prof/main`
- Push force la branche master : `git push -f`
- Créer une nouvelle branche pour la journée : `git checkout -b jour3`
- Push la nouvelle branche : `git push` et suivre les indications

Bon courage ! Amusez vous bien avec l'API !

